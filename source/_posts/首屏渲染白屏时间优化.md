---
title: 首屏渲染白屏时间优化
date: 2022-03-23 15:05:08
tags: ['性能优化']
categories: '性能优化'
---

+ 如何分析首屏加载CSR的性能？
+ 分析后如何找出CSR性能瓶颈？
+ 如何解决CSR性能瓶颈？
+ 有没有其他渲染方案可以解决CSR当前问题，他的原理是什么？
> CSR(Client Side Rendering 客户端渲染) 


# 如何分析
* network
* performance
* lighthouse
* sentry
* [webPageTest](https://webpagetest.org/)

# 如何解决

## 网络层面：
从网络方面来讲，就是减少HTTP请求的次数，以及减小请求体积，这里就简单聊几点
+ 将多次请求合并到一次请求（ajax、精灵图，文件合并等）
+ 页面懒加载应该也可以算在这个方面。
+ 缓存住一些不经常改动的文件或内容将请求拦截（service worker）
+ 文件内容压缩
+ 静态资源CDN也是方式之一
+ 升级到 http2
+ 脚本的延迟执行
+ 优化 CSS

## 渲染层面
+ 骨架屏，起码能让用户有打开了网页的感觉
+ 图片懒加载
+ 防抖节流
+ 代码层面的改善吧，很有可能是某些坏代码产生的

## SSR 
就是将框架代码提前在服务端跑一遍，不过一般除非对SEO要求比较高或者你们公司比较有钱，否则不太会去使用，因为比较占用服务器的资源。

<!-- ## 服务器与CDN的解决方式

合理的配置资源缓存方式,以及选用靠谱的 `CDN` 服务。服务端启用`gzip`等压缩模式压缩这些静态资源加快传输

## 静态资源优化

## 脚本的加载执行

**延迟非关键资源的加载，加速`css`传送。**
我们可以在服务端启用http2加速资源的发送这样我们就可以节省一个RTT达到更快的解析渲染,确保第三方资源javascript的异步加载。比如你在使用element,antd这些 cdn 资源我们应该在`<script />`上设置async。

`defer`就是上文说到的`blocking script`，async就是当 `HTML` 解析到开始加载他是无视DOM和渲染以及`onload`的。
而现代浏览器的正确做法应该是使用DOM动态创建`script async`标签去加载资源。
现有大部分的框架以及`bundle`工具都支持切割代码我们可以把这些资源都切割保证首屏的js足够轻量级。

## 优化CSS
css 的渲染取决于一组匹配选择器 不合理的选择器会导致解析过慢,css 选择器的解析顺序是从右到左，所以在面对复杂的 css 场景我们应该根据 Steve Souders大师总结的css选择器性能排行合理的选择方案达到更快的解析以及渲染  
 
## 采用SSR（同构渲染）

上述是通用的资源响应解决手段。但是`csr`总归是有作为`csr`的局限性。这时候我们就得回归本质`ssr`在服务端解析出了所有的`dom`生成了`string`这样在访问的时候和`csr`需要解析在合成渲染是截然不同的,现代的ssr框架允许模块采用csr加载我们可以在首屏重要的部分进行`ssr`其他采用csr。合理的搭配我们的渲染结构。 -->